<html>
<head>
	<script src="ned.js"></script>
	<script src="https://ariutta.github.io/svg-pan-zoom/dist/svg-pan-zoom.min.js"></script>
	<link rel="stylesheet" type="text/css" href="ned.css">
</head>
<body>
	<svg id="svg">
		<defs>
			<pattern id="smallGrid" width="10" height="10" patternUnits="userSpaceOnUse">
				<path d="M 10 0 L 0 0 0 10" fill="none" stroke="gray" stroke-width="0.5"/>
			</pattern>
			<pattern id="grid" width="100" height="100" patternUnits="userSpaceOnUse">
				<rect width="100" height="100" fill="url(#smallGrid)"/>
				<path d="M 100 0 L 0 0 0 100" fill="none" stroke="gray" stroke-width="1"/>
			</pattern>
		</defs>

		<rect width="200%" height="200%" fill="url(#grid)" />
	</svg>

	<script>
		var editor = Object.create(Ned);
		editor.init("svg");
		editor.snapping = 10;
		//editor.singleInputs = true;
		editor.singleOutputs = true;

		var n1 = Object.create(Ned.Node);
		n1.init (editor, "Test node");
		n1.position = { x: 100, y: 180};

		var n1i1 = n1.addInput("");
		var n1i2 = n1.addInput("Input B");

		var n1o1 = n1.addOutput("Output A");
		var n1o2 = n1.addOutput("Output B");

		var n2 = Object.create(Ned.Node);
		n2.init (editor, "Start");
		var n2o1 = n2.addOutput("Output")

		var n3 = Object.create(Ned.Node);
		n3.init (editor, "Other test");
		var n3i1 = n3.addInput("Input B");
		var n3o1 = n3.addOutput("Output");

		var panZoom = svgPanZoom(editor.svg, {
			viewportSelector: ".svg-pan-zoom_viewport", 
			panEnabled: true, 
			controlIconsEnabled: true, 
			zoomEnabled: true, 
			dblClickZoomEnabled: false, 
			mouseWheelZoomEnabled: true, 
			preventMouseEventsDefault: false, 
			zoomScaleSensitivity: 0.2, 
			minZoom: 0.5, 
			maxZoom: 2, 
			fit: false, 
			contain: false, 
			center: false, 
			refreshRate: "auto"
		});

		editor.view = {
			screenToWorld(pos) {
				var rect = editor.svg.getBoundingClientRect();
				var pan = panZoom.getPan();
				var zoom = panZoom.getZoom();
				var offset = { x: pan.x + rect.left, y: pan.y + rect.top, };

				return { 
					x: (((pos.x - rect.left) - pan.x) / zoom), 
					y: (((pos.y - rect.top) - pan.y) / zoom)
				};
			},
			worldToScreen(pos) {
				return pos;
			}
		};

		//handle grid tilling

		window.addEventListener("resize", (e) => {
			panZoom.resize();
		}, true);
	</script>
</body>
</html>
